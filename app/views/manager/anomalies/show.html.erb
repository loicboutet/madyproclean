<% content_for :title, "D√©tail Anomalie - Portail Manager" %>

<div style="margin-bottom: 2rem;">
  <!-- Header -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
    <div>
      <h2 style="font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, #00D4FF, #00FFE0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 0 0 0.5rem 0;">
        D√©tail de l'Anomalie #<%= @anomaly.id %>
      </h2>
      <%= link_to manager_anomalies_path, style: "color: rgba(255, 255, 255, 0.7); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: color 0.2s ease;" do %>
        <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Retour aux anomalies
      <% end %>
    </div>
    
    <% unless @anomaly.resolved %>
      <%= button_to "‚úì Marquer comme R√©solue", resolve_manager_anomaly_path(@anomaly), method: :post, class: "btn-primary", style: "padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #4CAF50, #81C784); border: none; border-radius: 0.5rem; color: #FFFFFF; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 0.875rem;" %>
    <% end %>
  </div>

  <!-- Anomaly Details Card -->
  <div class="glass-card" style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 1rem; padding: 2rem; margin-bottom: 2rem;">
    <!-- Status Badge -->
    <div style="margin-bottom: 2rem;">
      <% if @anomaly.resolved %>
        <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 0.5rem; color: #81C784; font-size: 1rem; font-weight: 600;">
          <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          Anomalie R√©solue
        </span>
      <% else %>
        <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: rgba(255, 193, 7, 0.2); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 0.5rem; color: #FFC107; font-size: 1rem; font-weight: 600;">
          <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
          Anomalie En Attente
        </span>
      <% end %>
    </div>

    <!-- Main Information -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
      <!-- Type -->
      <div>
        <div style="font-size: 0.875rem; font-weight: 600; color: var(--cyan-electric); margin-bottom: 0.5rem;">
          Type d'Anomalie
        </div>
        <div style="font-size: 1.125rem; color: rgba(255, 255, 255, 0.9);">
          <%= @anomaly.type_label %>
        </div>
      </div>

      <!-- Severity -->
      <div>
        <div style="font-size: 0.875rem; font-weight: 600; color: var(--cyan-electric); margin-bottom: 0.5rem;">
          S√©v√©rit√©
        </div>
        <div style="font-size: 1.125rem; color: rgba(255, 255, 255, 0.9);">
          <%= @anomaly.severity_label %>
        </div>
      </div>

      <!-- Date -->
      <div>
        <div style="font-size: 0.875rem; font-weight: 600; color: var(--cyan-electric); margin-bottom: 0.5rem;">
          Date de D√©tection
        </div>
        <div style="font-size: 1.125rem; color: rgba(255, 255, 255, 0.9);">
          <%= @anomaly.created_at.strftime('%d/%m/%Y √† %H:%M') %>
        </div>
      </div>
    </div>

    <!-- Description -->
    <div style="padding: 1.5rem; background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 0.75rem; margin-bottom: 2rem;">
      <div style="font-size: 0.875rem; font-weight: 600; color: var(--cyan-electric); margin-bottom: 0.75rem;">
        Description
      </div>
      <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9); line-height: 1.6;">
        <%= @anomaly.description %>
      </div>
    </div>

    <!-- Associated User -->
    <% if @anomaly.user.present? %>
      <div style="margin-bottom: 2rem;">
        <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--cyan-electric); margin-bottom: 1rem;">
          üë§ Agent Concern√©
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Nom</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.user.full_name %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Num√©ro Employ√©</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.user.employee_number %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Email</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.user.email %></div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Associated Time Entry -->
    <% if @anomaly.time_entry.present? %>
      <div style="margin-bottom: 2rem;">
        <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--cyan-electric); margin-bottom: 1rem;">
          üïê Pointage Associ√©
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Site</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.time_entry.site&.name || 'N/A' %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Heure d'Arriv√©e</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.time_entry.clocked_in_at&.strftime('%d/%m/%Y %H:%M') || 'N/A' %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Heure de D√©part</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.time_entry.clocked_out_at&.strftime('%d/%m/%Y %H:%M') || 'Non enregistr√©e' %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Action</div>
            <div style="font-size: 1rem;">
              <%= link_to "Voir le Pointage", manager_time_entry_path(@anomaly.time_entry), style: "color: var(--cyan-electric); text-decoration: none; display: inline-flex; align-items: center; gap: 0.375rem; transition: color 0.2s ease;" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Associated Schedule -->
    <% if @anomaly.schedule.present? %>
      <div style="margin-bottom: 2rem;">
        <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--cyan-electric); margin-bottom: 1rem;">
          üìÖ Planning Associ√©
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Site</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.schedule.site&.name || 'N/A' %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Date Planifi√©e</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.schedule.scheduled_date&.strftime('%d/%m/%Y') || 'N/A' %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Heure D√©but</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.schedule.start_time&.strftime('%H:%M') || 'N/A' %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Heure Fin</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.schedule.end_time&.strftime('%H:%M') || 'N/A' %></div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Resolution Info -->
    <% if @anomaly.resolved %>
      <div style="padding: 1.5rem; background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 0.75rem;">
        <h3 style="font-size: 1.25rem; font-weight: 600; color: #81C784; margin-bottom: 1rem;">
          ‚úì Informations de R√©solution
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">R√©solu Par</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.resolved_by&.full_name || 'N/A' %></div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Date de R√©solution</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"><%= @anomaly.resolved_at&.strftime('%d/%m/%Y √† %H:%M') || 'N/A' %></div>
          </div>
        </div>
        <% if @anomaly.resolution_notes.present? %>
          <div style="margin-top: 1.5rem;">
            <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.5rem;">Notes de R√©solution</div>
            <div style="font-size: 1rem; color: rgba(255, 255, 255, 0.9); line-height: 1.6;"><%= @anomaly.resolution_notes %></div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Action Buttons -->
  <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
    <%= link_to manager_anomalies_path, class: "btn-secondary", style: "padding: 0.75rem 1.5rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 0.5rem; color: #FFFFFF; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;" do %>
      <svg style="width: 1.125rem; height: 1.125rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Retour √† la Liste
    <% end %>
    
    <% if @anomaly.time_entry.present? %>
      <%= link_to "Voir le Pointage", manager_time_entry_path(@anomaly.time_entry), class: "btn-primary", style: "padding: 0.75rem 1.5rem; background: linear-gradient(135deg, var(--cyan-electric), var(--turquoise)); border: none; border-radius: 0.5rem; color: #FFFFFF; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;" %>
    <% end %>
  </div>
</div>
