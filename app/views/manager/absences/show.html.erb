<% content_for :page_title, "D√©tails de l'Absence ##{@absence[:id]}" %>

<!-- Page Header -->
<div class="glass-card">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="gradient-heading">D√©tails de l'Absence #<%= @absence[:id] %></h1>
      <p class="text-large mt-2">Informations compl√®tes de cette absence</p>
    </div>
    <div class="button-group">
      <%= link_to edit_manager_absence_path(@absence[:id]), class: "btn-primary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
        Modifier
      <% end %>
      <%= link_to manager_absences_path, class: "btn-secondary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Retour √† la liste
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Status Card -->
<div class="card">
  <div class="flex items-center justify-between mb-6">
    <h2 style="font-size: 1.875rem;">Type d'Absence</h2>
    <% if @absence[:absence_type] == 'vacation' %>
      <span class="badge-success" style="font-size: 1.125rem; padding: 0.75rem 1.5rem;">üèñÔ∏è Cong√©s pay√©s</span>
    <% elsif @absence[:absence_type] == 'sick_leave' %>
      <span class="badge-warning" style="font-size: 1.125rem; padding: 0.75rem 1.5rem;">üè• Cong√© maladie</span>
    <% elsif @absence[:absence_type] == 'training' %>
      <span class="badge-info" style="font-size: 1.125rem; padding: 0.75rem 1.5rem;">üìö Formation</span>
    <% elsif @absence[:absence_type] == 'unpaid_leave' %>
      <span class="badge" style="font-size: 1.125rem; padding: 0.75rem 1.5rem;">üíº Cong√© sans solde</span>
    <% elsif @absence[:absence_type] == 'other' %>
      <span class="badge" style="font-size: 1.125rem; padding: 0.75rem 1.5rem;">üìã Autre</span>
    <% end %>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon stat-icon-success">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Agent Concern√©</p>
        <p class="stat-value" style="font-size: 1.25rem;"><%= @absence[:user_name] %></p>
        <p class="text-sm opacity-70 mt-1"><%= @absence[:employee_number] %></p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-primary">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Date de D√©but</p>
        <p class="stat-value" style="font-size: 1.5rem;"><%= @absence[:start_date].strftime('%d/%m/%Y') %></p>
        <p class="text-sm opacity-70 mt-1"><%= l(@absence[:start_date], format: '%A') %></p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-info">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Date de Fin</p>
        <p class="stat-value" style="font-size: 1.5rem;"><%= @absence[:end_date].strftime('%d/%m/%Y') %></p>
        <p class="text-sm opacity-70 mt-1"><%= l(@absence[:end_date], format: '%A') %></p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-warning">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Dur√©e Totale</p>
        <% days = (@absence[:end_date] - @absence[:start_date]).to_i + 1 %>
        <p class="stat-value" style="font-size: 1.5rem;"><%= days %> jour<%= 's' if days > 1 %></p>
        <p class="text-sm opacity-70 mt-1"><%= days == 1 ? 'Journ√©e unique' : 'P√©riode de ' + days.to_s + ' jours' %></p>
      </div>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Absence Details -->
<div class="card">
  <h2 class="mb-6" style="font-size: 1.875rem;">
    <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    Informations D√©taill√©es
  </h2>

  <div class="form-grid">
    <div class="form-group">
      <label>ID de l'Absence</label>
      <div class="">
        <p class="font-semibold text-lg">#<%= @absence[:id] %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Type d'Absence</label>
      <div class="">
        <% if @absence[:absence_type] == 'vacation' %>
          <span class="badge-success">üèñÔ∏è Cong√©s pay√©s</span>
        <% elsif @absence[:absence_type] == 'sick_leave' %>
          <span class="badge-warning">üè• Cong√© maladie</span>
        <% elsif @absence[:absence_type] == 'training' %>
          <span class="badge-info">üìö Formation</span>
        <% elsif @absence[:absence_type] == 'unpaid_leave' %>
          <span class="badge">üíº Cong√© sans solde</span>
        <% elsif @absence[:absence_type] == 'other' %>
          <span class="badge">üìã Autre</span>
        <% end %>
      </div>
    </div>

    <div class="form-group">
      <label>Agent</label>
      <div class="">
        <p class="font-semibold"><%= @absence[:user_name] %></p>
        <p class="text-sm opacity-70"><%= @absence[:employee_number] %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Dur√©e de l'Absence</label>
      <div class="">
        <% days = (@absence[:end_date] - @absence[:start_date]).to_i + 1 %>
        <p class="font-semibold"><%= days %> jour<%= 's' if days > 1 %></p>
        <p class="text-sm opacity-70">Du <%= @absence[:start_date].strftime('%d/%m/%Y') %> au <%= @absence[:end_date].strftime('%d/%m/%Y') %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Date de D√©but</label>
      <div class="">
        <p class="font-semibold"><%= @absence[:start_date].strftime('%d/%m/%Y') %></p>
        <p class="text-sm opacity-70"><%= l(@absence[:start_date], format: '%A %d %B %Y') %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Date de Fin</label>
      <div class="">
        <p class="font-semibold"><%= @absence[:end_date].strftime('%d/%m/%Y') %></p>
        <p class="text-sm opacity-70"><%= l(@absence[:end_date], format: '%A %d %B %Y') %></p>
      </div>
    </div>

    <div class="form-group">
      <label>D√©clar√© par</label>
      <div class="">
        <p class="font-semibold"><%= @absence[:declared_by_name] %></p>
        <p class="text-sm opacity-70">Manager/Superviseur</p>
      </div>
    </div>

    <div class="form-group">
      <label>Date de Cr√©ation</label>
      <div class="">
        <p class="font-semibold"><%= @absence[:created_at].strftime('%d/%m/%Y √† %H:%M') %></p>
        <% if @absence[:updated_at] != @absence[:created_at] %>
          <p class="text-sm opacity-70">Mis √† jour le <%= @absence[:updated_at].strftime('%d/%m/%Y √† %H:%M') %></p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<% if @absence[:reason].present? %>
  <div class="divider"></div>

  <!-- Reason -->
  <div class="card">
    <h2 class="mb-6" style="font-size: 1.875rem;">
      <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
      Raison de l'Absence
    </h2>
    
    <div class="p-4 rounded-lg border border-blue-200" style="">
      <p class="text-base"><%= @absence[:reason] %></p>
    </div>
  </div>
<% end %>

<% if @absence[:notes].present? %>
  <div class="divider"></div>

  <!-- Notes -->
  <div class="card">
    <h2 class="mb-6" style="font-size: 1.875rem;">
      <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
      </svg>
      Notes / Observations
    </h2>
    
    <div class="p-4 rounded-lg border border-gray-200" style="">
      <p class="text-base"><%= @absence[:notes] %></p>
    </div>
  </div>
<% end %>

<div class="divider"></div>

<!-- Actions -->
<div class="glass-card">
  <h2 class="mb-4" style="font-size: 1.875rem;">Actions</h2>
  
  <div class="alert alert-info mb-6">
    <strong>Information:</strong> En tant que manager, vous pouvez modifier ou supprimer cette d√©claration d'absence.
  </div>
  
  <div class="button-group">
    <%= link_to edit_manager_absence_path(@absence[:id]), class: "btn-primary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
      </svg>
      Modifier cette absence
    <% end %>
    
    <%= link_to manager_absences_path, class: "btn-secondary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Retour √† la liste
    <% end %>
    
    <%= link_to manager_absence_path(@absence[:id]), method: :delete, data: { confirm: '√ätes-vous s√ªr de vouloir supprimer cette absence ?' }, class: "btn-danger" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
      </svg>
      Supprimer cette absence
    <% end %>
  </div>
</div>
