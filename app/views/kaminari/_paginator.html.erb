<%# The container tag
  - available local variables
    current_page:  a page object for the currently displayed page
    total_pages:   total number of pages
    per_page:      number of items to fetch per page
    remote:        data-remote
    paginator:     the paginator that renders the pagination tags inside
-%>
<%
  # Permit filter parameters based on the current controller
  # Check if params responds to permit (ActionController::Parameters)
  # If not, it's already a hash and we can use it directly
  permitted_params = if params.respond_to?(:permit)
    case controller_name
    when 'anomalies'
      params.permit(:search, :anomaly_type, :severity, :user_id, :date, :resolved, :page)
    when 'time_entries'
      params.permit(:user_id, :site_id, :status, :start_date, :end_date, :search, :page)
    when 'sites'
      params.permit(:search, :active, :page)
    when 'users'
      params.permit(:search, :role, :active, :page)
    when 'absences'
      params.permit(:search, :user_id, :start_date, :end_date, :absence_type, :page)
    when 'schedules'
      params.permit(:search, :user_id, :site_id, :start_date, :end_date, :page)
    when 'reports'
      params.permit(:search, :report_type, :start_date, :end_date, :page, :status, :month, :year, :user_id, :site_id)
    else
      params.permit(:search, :page)
    end
  else
    # params is already a hash, filter it manually
    allowed_keys = case controller_name
    when 'anomalies'
      [:search, :anomaly_type, :severity, :user_id, :date, :resolved, :page]
    when 'time_entries'
      [:user_id, :site_id, :status, :start_date, :end_date, :search, :page]
    when 'sites'
      [:search, :active, :page]
    when 'users'
      [:search, :role, :active, :page]
    when 'absences'
      [:search, :user_id, :start_date, :end_date, :absence_type, :page]
    when 'schedules'
      [:search, :user_id, :site_id, :start_date, :end_date, :page]
    when 'reports'
      [:search, :report_type, :start_date, :end_date, :page, :status, :month, :year, :user_id, :site_id]
    else
      [:search, :page]
    end
    params.slice(*allowed_keys)
  end
%>
<% if total_pages > 0 %>
  <div class="pagination-wrapper">
    <!-- Pagination Info -->
    <div class="pagination-info">
      <p class="pagination-text">
        Page <strong><%= current_page.number %></strong> sur <strong><%= total_pages %></strong>
      </p>
    </div>

    <!-- Pagination Controls -->
    <% if total_pages > 1 %>
      <nav class="pagination-nav" role="navigation" aria-label="Pagination">
        <ul class="pagination-list">
          <%= render 'kaminari/prev_page', current_page: current_page, total_pages: total_pages, per_page: per_page, remote: remote, url: (current_page.first? ? '#' : url_for(permitted_params.merge(page: current_page.number - 1))) %>
          <% paginator.each_relevant_page do |page| %>
            <% if page.left_outer? || page.right_outer? || page.inside_window? %>
              <%= render 'kaminari/page', page: page, current_page: current_page, total_pages: total_pages, per_page: per_page, remote: remote, url: url_for(permitted_params.merge(page: page.number)) %>
            <% elsif !page.was_truncated? -%>
              <%= render 'kaminari/gap' %>
            <% end %>
          <% end %>
          <%= render 'kaminari/next_page', current_page: current_page, total_pages: total_pages, per_page: per_page, remote: remote, url: (current_page.last? ? '#' : url_for(permitted_params.merge(page: current_page.number + 1))) %>
        </ul>
      </nav>
    <% end %>
  </div>
<% end %>
