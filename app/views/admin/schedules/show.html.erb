<% content_for :page_title, "Détails de l'Horaire ##{@schedule[:id]}" %>

<!-- Page Header -->
<div class="glass-card">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="gradient-heading">Détails de l'Horaire #<%= @schedule[:id] %></h1>
      <p class="text-large mt-2">Informations complètes de cet horaire planifié</p>
    </div>
    <div class="button-group">
      <%= link_to admin_schedules_path, class: "btn-secondary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Retour à la liste
      <% end %>
      <%= link_to edit_admin_schedule_path(@schedule[:id]), class: "btn-primary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
        Modifier
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Status Card -->
<div class="card">
  <div class="flex items-center justify-between mb-6">
    <h2 style="font-size: 1.875rem;">Statut de l'Horaire</h2>
    <span style="font-size: 1.125rem; padding: 0.75rem 1.5rem;">
      <%= render 'shared/schedules/status_badge', status: @schedule[:status], namespace: 'admin' %>
    </span>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon stat-icon-primary">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Date Planifiée</p>
        <p class="stat-value" style="font-size: 1.5rem;"><%= @schedule[:scheduled_date].strftime('%d/%m/%Y') %></p>
        <p class="text-sm opacity-70 mt-1"><%= l(@schedule[:scheduled_date], format: '%A') %></p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-info">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Horaires</p>
        <p class="stat-value" style="font-size: 1.5rem;"><%= @schedule[:start_time] %> - <%= @schedule[:end_time] %></p>
        <% 
          start_parts = @schedule[:start_time].split(':')
          end_parts = @schedule[:end_time].split(':')
          duration = (end_parts[0].to_i - start_parts[0].to_i) + ((end_parts[1].to_i - start_parts[1].to_i) / 60.0)
        %>
        <p class="text-sm opacity-70 mt-1"><%= '%.1f' % duration %> heures de travail</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-success">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Agent Assigné</p>
        <p class="stat-value" style="font-size: 1.25rem;"><%= @schedule[:user_name] %></p>
        <p class="text-sm opacity-70 mt-1"><%= @schedule[:employee_number] %></p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-warning">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Site de Travail</p>
        <p class="stat-value" style="font-size: 1.25rem;"><%= @schedule[:site_name] %></p>
        <p class="text-sm opacity-70 mt-1"><span class="badge"><%= @schedule[:site_code] %></span></p>
      </div>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Schedule Details -->
<div class="card">
  <h2 class="mb-6" style="font-size: 1.875rem;">
    <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    Informations Détaillées
  </h2>

  <div class="form-grid">
    <div class="form-group">
      <label>ID de l'Horaire</label>
      <div class="">
        <p class="font-semibold text-lg">#<%= @schedule[:id] %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Statut</label>
      <div class="">
        <%= render 'shared/schedules/status_badge', status: @schedule[:status], namespace: 'admin' %>
      </div>
    </div>

    <div class="form-group">
      <label>Agent</label>
      <div class="">
        <p class="font-semibold"><%= @schedule[:user_name] %></p>
        <p class="text-sm opacity-70"><%= @schedule[:employee_number] %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Site</label>
      <div class="">
        <p class="font-semibold"><%= @schedule[:site_name] %></p>
        <p class="text-sm opacity-70"><span class="badge"><%= @schedule[:site_code] %></span></p>
      </div>
    </div>

    <div class="form-group">
      <label>Date Planifiée</label>
      <div class="">
        <p class="font-semibold"><%= @schedule[:scheduled_date].strftime('%d/%m/%Y') %></p>
        <p class="text-sm opacity-70"><%= l(@schedule[:scheduled_date], format: '%A') %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Plage Horaire</label>
      <div class="">
        <p class="font-semibold"><%= @schedule[:start_time] %> - <%= @schedule[:end_time] %></p>
        <% 
          start_parts = @schedule[:start_time].split(':')
          end_parts = @schedule[:end_time].split(':')
          duration = (end_parts[0].to_i - start_parts[0].to_i) + ((end_parts[1].to_i - start_parts[1].to_i) / 60.0)
        %>
        <p class="text-sm opacity-70"><%= '%.1f' % duration %> heures</p>
      </div>
    </div>

    <div class="form-group">
      <label>Créé par</label>
      <div class="">
        <p class="font-semibold"><%= @schedule[:created_by_name] %></p>
        <p class="text-sm opacity-70">Le <%= @schedule[:created_at].strftime('%d/%m/%Y à %H:%M') %></p>
      </div>
    </div>

    <div class="form-group">
      <label>Dernière Modification</label>
      <div class="">
        <p class="font-semibold"><%= @schedule[:updated_at].strftime('%d/%m/%Y à %H:%M') %></p>
      </div>
    </div>
  </div>

  <% if @schedule[:notes].present? %>
    <div class="divider"></div>
    <div class="form-group">
      <label>Notes / Observations</label>
      <div class="p-4 rounded-lg border border-blue-200">
        <p class="text-base"><%= @schedule[:notes] %></p>
      </div>
    </div>
  <% end %>
</div>

<div class="divider"></div>

<%= render 'shared/schedules/replacement_info', show_original_agent: true %>

<div class="divider"></div>

<!-- Actions -->
<div class="glass-card">
  <h2 class="mb-4" style="font-size: 1.875rem;">Actions</h2>
  
  <div class="button-group">
    <%= link_to edit_admin_schedule_path(@schedule[:id]), class: "btn-primary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
      </svg>
      Modifier cet horaire
    <% end %>

    <%= link_to admin_schedules_path, class: "btn-secondary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Retour à la liste
    <% end %>

    <% if @schedule[:status] != 'cancelled' %>
      <%= button_to admin_schedule_path(@schedule[:id]), method: :delete, data: { confirm: 'Êtes-vous sûr de vouloir annuler cet horaire ?' }, class: "btn-danger" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
        Annuler cet horaire
      <% end %>
    <% end %>
  </div>
</div>
