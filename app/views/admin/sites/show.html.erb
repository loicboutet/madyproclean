<% content_for :page_title, "Site ##{@site.id}" %>

<!-- Page Header -->
<div class="glass-card">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="gradient-heading"><%= @site.name %></h1>
      <p class="text-large mt-2">Détails complets du site</p>
    </div>
    <div class="button-group">
      <%= link_to admin_sites_path, class: "btn-secondary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Retour à la liste
      <% end %>
      <%= link_to edit_admin_site_path(@site), class: "btn-primary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
        Modifier
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Status Badge -->
<div class="card">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="mb-2">Statut du Site</h2>
    </div>
    <div>
      <% if @site.active %>
        <span class="badge-success" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;">✓ Actif</span>
      <% else %>
        <span class="badge-warning" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;">✗ Inactif</span>
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Main Information -->
<div class="form-grid">
  <!-- Site Information -->
  <%= render 'shared/sites/site_info_card', site: @site, style: 'admin' %>

  <!-- QR Code Information -->
  <%= render 'shared/sites/qr_code_info', site: @site, qr_code_path: qr_code_admin_site_path(@site), style: 'admin' %>
</div>

<div class="divider"></div>

<!-- Timestamp Information -->
<div class="card">
  <h2 class="mb-4">
    <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    Historique
  </h2>
  
  <div class="form-grid">
    <div>
      <p class="text-sm opacity-70">Date de création</p>
      <% if @site.created_at %>
        <p class="font-semibold"><%= @site.created_at.strftime('%d/%m/%Y à %H:%M') %></p>
      <% else %>
        <p class="font-semibold">N/A</p>
      <% end %>
    </div>
    
    <div>
      <p class="text-sm opacity-70">Dernière modification</p>
      <% if @site.updated_at %>
        <p class="font-semibold"><%= @site.updated_at.strftime('%d/%m/%Y à %H:%M') %></p>
      <% else %>
        <p class="font-semibold">N/A</p>
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Statistics Section -->
<div class="card">
  <h2 class="mb-4">
    <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
    </svg>
    Statistiques
  </h2>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon stat-icon-primary">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Pointages totaux</p>
        <p class="stat-value"><%= @total_time_entries %></p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-success">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Agents actuels</p>
        <p class="stat-value"><%= @current_agents_count %></p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-info">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Planifications</p>
        <p class="stat-value"><%= @schedules_count %></p>
      </div>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Current Agents on Site -->
<div class="card">
  <h2 class="mb-4">
    <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
    </svg>
    Agents Actuellement sur le Site
  </h2>
  
  <%= render 'shared/sites/current_agents', current_time_entries: @current_time_entries, style: 'admin' %>
</div>

<div class="divider"></div>

<!-- Actions -->
<div class="card">
  <h2 class="mb-4">Actions disponibles</h2>
  
  <div class="button-group">
    <%= link_to edit_admin_site_path(@site), class: "btn-primary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
      </svg>
      Modifier ce site
    <% end %>

    <%= link_to qr_code_admin_site_path(@site), class: "btn-primary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2m5-7v2M7 4h10"/>
      </svg>
      Afficher le QR Code
    <% end %>
    
    <%= link_to admin_sites_path, class: "btn-secondary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Retour à la liste
    <% end %>
    
    <% if @site.active %>
      <%= button_to admin_site_path(@site), method: :delete, data: { confirm: 'Êtes-vous sûr de vouloir désactiver ce site ?' }, class: "btn-danger" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
        </svg>
        Désactiver ce site
      <% end %>
    <% end %>
  </div>
</div>
