<% content_for :page_title, "Détails de l'Utilisateur ##{@user[:id]}" %>

<% 
  role_badge_class = case @user[:role]
    when 'admin' then 'badge-danger'
    when 'manager' then 'badge-warning'
    when 'agent' then 'badge-info'
    else 'badge'
  end
%>

<!-- Page Header -->
<div class="glass-card">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="gradient-heading"><%= @user[:first_name] %> <%= @user[:last_name] %></h1>
      <p class="text-large mt-2">Détails complets de l'utilisateur</p>
    </div>
    <div class="button-group">
      <%= link_to admin_users_path, class: "btn-secondary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Retour à la liste
      <% end %>
      <%= link_to edit_admin_user_path(@user[:id]), class: "btn-primary" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
        Modifier
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Status Badge -->
<div class="card mb-6">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="mb-2">Statut de l'Utilisateur</h2>
    </div>
    <div>
      <% if @user[:active] %>
        <span class="badge-success" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;">✓ Actif</span>
      <% else %>
        <span class="badge-warning" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;">✗ Inactif</span>
      <% end %>
    </div>
  </div>
</div>

<!-- Main Information -->
<div class="form-grid">
  <!-- Personal Information -->
  <div class="card">
    <h2 class="mb-4">
      <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
      </svg>
      Informations Personnelles
    </h2>
    <div class="space-y-3">
      <div>
        <p class="text-sm opacity-70">Prénom</p>
        <p class="font-semibold text-lg"><%= @user[:first_name] %></p>
      </div>
      <div>
        <p class="text-sm opacity-70">Nom</p>
        <p class="font-semibold text-lg"><%= @user[:last_name] %></p>
      </div>
      <div>
        <p class="text-sm opacity-70">Nom complet</p>
        <p class="font-semibold"><%= @user[:first_name] %> <%= @user[:last_name] %></p>
      </div>
    </div>
  </div>

  <!-- Contact Information -->
  <div class="card">
    <h2 class="mb-4">
      <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
      </svg>
      Coordonnées
    </h2>
    <div class="space-y-3">
      <div>
        <p class="text-sm opacity-70">Email</p>
        <p class="font-semibold"><%= @user[:email] %></p>
      </div>
      <% if @user[:phone_number].present? %>
        <div>
          <p class="text-sm opacity-70">Téléphone</p>
          <p class="font-semibold"><%= @user[:phone_number] %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Employment Information -->
<div class="form-grid">
  <!-- Role & Permissions -->
  <div class="card">
    <h2 class="mb-4">
      <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
      </svg>
      Rôle et Permissions
    </h2>
    <div class="space-y-3">
      <div>
        <p class="text-sm opacity-70">Rôle</p>
        <p class="font-semibold">
          <span class="<%= role_badge_class %>" style="font-size: 1rem;">
            <%= @user[:role].capitalize %>
          </span>
        </p>
      </div>
      <div>
        <p class="text-sm opacity-70">Niveau d'accès</p>
        <p class="font-semibold">
          <% case @user[:role] %>
            <% when 'admin' %>
              Accès complet - Gestion du système
            <% when 'manager' %>
              Gestion d'équipe - Planification et absences
            <% when 'agent' %>
              Agent terrain - Pointage uniquement
          <% end %>
        </p>
      </div>
    </div>
  </div>

  <!-- Employment Details -->
  <div class="card">
    <h2 class="mb-4">
      <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
      </svg>
      Informations Professionnelles
    </h2>
    <div class="space-y-3">
      <div>
        <p class="text-sm opacity-70">Matricule</p>
        <% if @user[:employee_number].present? %>
          <p class="font-semibold"><span class="badge" style="font-size: 1rem;"><%= @user[:employee_number] %></span></p>
        <% else %>
          <p class="font-semibold opacity-50">Non attribué</p>
        <% end %>
      </div>
      <% if @user[:role] == 'agent' %>
        <div>
          <p class="text-sm opacity-70">Manager assigné</p>
          <% if @manager %>
            <p class="font-semibold">
              <%= link_to admin_user_path(@manager[:id]), class: "text-blue-600 hover:underline" do %>
                <%= @manager[:first_name] %> <%= @manager[:last_name] %>
              <% end %>
            </p>
          <% else %>
            <p class="font-semibold opacity-50">Aucun manager assigné</p>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Timestamp Information -->
<div class="card">
  <h2 class="mb-4">
    <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    Historique
  </h2>
  
  <div class="form-grid">
    <div>
      <p class="text-sm opacity-70">Date de création</p>
      <% if @user[:created_at] %>
        <p class="font-semibold"><%= @user[:created_at].strftime('%d/%m/%Y à %H:%M') %></p>
      <% else %>
        <p class="font-semibold">N/A</p>
      <% end %>
    </div>
    
    <div>
      <p class="text-sm opacity-70">Dernière modification</p>
      <% if @user[:updated_at] %>
        <p class="font-semibold"><%= @user[:updated_at].strftime('%d/%m/%Y à %H:%M') %></p>
      <% else %>
        <p class="font-semibold">N/A</p>
      <% end %>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- Statistics Section -->
<div class="card">
  <h2 class="mb-4">
    <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
    </svg>
    Statistiques (Démo)
  </h2>
  
  <div class="alert alert-info mb-4">
    <strong>Information:</strong> Ces statistiques sont destinées à la démonstration. Dans une version réelle, elles afficheraient les données de pointage et planifications liées à cet utilisateur.
  </div>

  <div class="stats-grid">
    <% if @user[:role] == 'agent' %>
      <div class="stat-card">
        <div class="stat-icon stat-icon-primary">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Pointages totaux</p>
          <p class="stat-value">--</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-success">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Planifications</p>
          <p class="stat-value">--</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-warning">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Absences</p>
          <p class="stat-value">--</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-info">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Heures travaillées</p>
          <p class="stat-value">--</p>
        </div>
      </div>
    <% elsif @user[:role] == 'manager' %>
      <div class="stat-card">
        <div class="stat-icon stat-icon-primary">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Agents gérés</p>
          <p class="stat-value"><%= @all_users.count { |u| u[:manager_id] == @user[:id] && u[:active] } %></p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-success">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Planifications créées</p>
          <p class="stat-value">--</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-warning">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Absences gérées</p>
          <p class="stat-value">--</p>
        </div>
      </div>
    <% else %>
      <div class="stat-card">
        <div class="stat-icon stat-icon-primary">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <div class="stat-content">
          <p class="stat-label">Accès administrateur</p>
          <p class="stat-value">Complet</p>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div class="divider"></div>

<!-- Actions -->
<div class="card">
  <h2 class="mb-4">Actions disponibles</h2>
  
  <div class="button-group">
    <%= link_to edit_admin_user_path(@user[:id]), class: "btn-primary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
      </svg>
      Modifier cet utilisateur
    <% end %>
    
    <%= link_to admin_users_path, class: "btn-secondary" do %>
      <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Retour à la liste
    <% end %>
    
    <% if @user[:active] %>
      <%= button_to admin_user_path(@user[:id]), method: :delete, data: { confirm: 'Êtes-vous sûr de vouloir désactiver cet utilisateur ?' }, class: "btn-danger" do %>
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
        </svg>
        Désactiver cet utilisateur
      <% end %>
    <% end %>
  </div>
</div>
